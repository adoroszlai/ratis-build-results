-------------------------------------------------------------------------------
Test set: org.apache.ratis.server.simulation.TestGroupManagementWithSimulatedRpc
-------------------------------------------------------------------------------
Tests run: 8, Failures: 3, Errors: 0, Skipped: 0, Time elapsed: 62.94 s <<< FAILURE! -- in org.apache.ratis.server.simulation.TestGroupManagementWithSimulatedRpc
org.apache.ratis.server.simulation.TestGroupManagementWithSimulatedRpc.testMultiGroup9Nodes -- Time elapsed: 19.07 s <<< FAILURE!
java.lang.AssertionError: Unexpected exit.
	at org.apache.ratis.util.ExitUtils.assertNotTerminated(ExitUtils.java:109)
	at org.apache.ratis.server.impl.MiniRaftCluster.shutdown(MiniRaftCluster.java:816)
	at org.apache.ratis.server.impl.GroupManagementBaseTest.runMultiGroupTest(GroupManagementBaseTest.java:343)
	at org.apache.ratis.server.impl.GroupManagementBaseTest.runMultiGroupTest(GroupManagementBaseTest.java:239)
	at org.apache.ratis.server.impl.GroupManagementBaseTest.testMultiGroup9Nodes(GroupManagementBaseTest.java:234)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	Suppressed: java.lang.AssertionError: Unexpected exit.
		at org.apache.ratis.util.ExitUtils.assertNotTerminated(ExitUtils.java:109)
		at org.apache.ratis.BaseTest.assertNoFailures(BaseTest.java:99)
		... 3 more
	Caused by: org.apache.ratis.util.ExitUtils$ExitException: s0.serverHandler2 is terminating.
		at org.apache.ratis.util.ExitUtils.terminate(ExitUtils.java:141)
		at org.apache.ratis.util.ExitUtils.terminate(ExitUtils.java:151)
		at org.apache.ratis.server.simulation.RequestHandler$HandlerDaemon.run(RequestHandler.java:138)
	Caused by: java.lang.IllegalStateException: s0@group-C0E65F787AE8-SegmentedRaftLog is expected to be opened but it is CLOSED
		at org.apache.ratis.util.OpenCloseState.assertOpen(OpenCloseState.java:63)
		at org.apache.ratis.server.raftlog.RaftLogBase.checkLogState(RaftLogBase.java:113)
		at org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.getLastEntryTermIndex(SegmentedRaftLog.java:356)
		at org.apache.ratis.server.impl.ServerState.getLastEntry(ServerState.java:316)
		at org.apache.ratis.server.impl.RaftServerImpl.requestVote(RaftServerImpl.java:1466)
		at org.apache.ratis.server.impl.RaftServerImpl.requestVote(RaftServerImpl.java:1422)
		at org.apache.ratis.server.impl.RaftServerProxy.requestVote(RaftServerProxy.java:642)
		at org.apache.ratis.server.simulation.SimulatedServerRpc$1.handleRequest(SimulatedServerRpc.java:165)
		at org.apache.ratis.server.simulation.SimulatedServerRpc$1.handleRequest(SimulatedServerRpc.java:153)
		at org.apache.ratis.server.simulation.RequestHandler.handleRequest(RequestHandler.java:91)
		at org.apache.ratis.server.simulation.RequestHandler$HandlerDaemon.run(RequestHandler.java:125)
	Caused by: org.apache.ratis.util.OpenCloseState$CloseTrace: Close s0@group-C0E65F787AE8-SegmentedRaftLog
		at org.apache.ratis.util.OpenCloseState.lambda$close$1(OpenCloseState.java:109)
		at java.util.concurrent.atomic.AtomicReference.getAndUpdate(AtomicReference.java:160)
		at org.apache.ratis.util.OpenCloseState.close(OpenCloseState.java:109)
		at org.apache.ratis.server.raftlog.RaftLogBase.close(RaftLogBase.java:394)
		at org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.close(SegmentedRaftLog.java:528)
		at org.apache.ratis.server.impl.ServerState.close(ServerState.java:440)
		at org.apache.ratis.server.impl.RaftServerImpl.lambda$close$1(RaftServerImpl.java:550)
		at org.apache.ratis.util.LifeCycle.lambda$checkStateAndClose$7(LifeCycle.java:309)
		at org.apache.ratis.util.LifeCycle.checkStateAndClose(LifeCycle.java:329)
		at org.apache.ratis.util.LifeCycle.checkStateAndClose(LifeCycle.java:307)
		at org.apache.ratis.server.impl.RaftServerImpl.close(RaftServerImpl.java:527)
		at org.apache.ratis.server.impl.RaftServerImpl.groupRemove(RaftServerImpl.java:485)
		at org.apache.ratis.server.impl.RaftServerProxy.lambda$groupRemoveAsync$15(RaftServerProxy.java:554)
		at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
		at java.util.concurrent.CompletableFuture.uniApplyStage(CompletableFuture.java:628)
		at java.util.concurrent.CompletableFuture.thenApply(CompletableFuture.java:1996)
		at org.apache.ratis.server.impl.RaftServerProxy.groupRemoveAsync(RaftServerProxy.java:553)
		at org.apache.ratis.server.impl.RaftServerProxy.groupManagementAsync(RaftServerProxy.java:502)
		at org.apache.ratis.server.impl.RaftServerProxy.groupManagement(RaftServerProxy.java:482)
		at org.apache.ratis.server.simulation.SimulatedServerRpc$2.handleRequest(SimulatedServerRpc.java:189)
		at org.apache.ratis.server.simulation.SimulatedServerRpc$2.handleRequest(SimulatedServerRpc.java:177)
		... 2 more
Caused by: [CIRCULAR REFERENCE: org.apache.ratis.util.ExitUtils$ExitException: s0.serverHandler2 is terminating.]

org.apache.ratis.server.simulation.TestGroupManagementWithSimulatedRpc.testGroupAlreadyExists -- Time elapsed: 0.003 s <<< FAILURE!
java.lang.AssertionError: Unexpected exit.
	at org.apache.ratis.util.ExitUtils.assertNotTerminated(ExitUtils.java:109)
	at org.apache.ratis.BaseTest.assertNoFailures(BaseTest.java:99)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	Suppressed: org.opentest4j.TestAbortedException: Assumption failed: Already exited with org.apache.ratis.util.ExitUtils$ExitException: s0.serverHandler2 is terminating.
		at org.apache.ratis.BaseTest.checkAssumptions(BaseTest.java:89)
		at org.apache.ratis.BaseTest.setup(BaseTest.java:76)
		... 3 more
Caused by: org.apache.ratis.util.ExitUtils$ExitException: s0.serverHandler2 is terminating.
	at org.apache.ratis.util.ExitUtils.terminate(ExitUtils.java:141)
	at org.apache.ratis.util.ExitUtils.terminate(ExitUtils.java:151)
	at org.apache.ratis.server.simulation.RequestHandler$HandlerDaemon.run(RequestHandler.java:138)
Caused by: java.lang.IllegalStateException: s0@group-C0E65F787AE8-SegmentedRaftLog is expected to be opened but it is CLOSED
	at org.apache.ratis.util.OpenCloseState.assertOpen(OpenCloseState.java:63)
	at org.apache.ratis.server.raftlog.RaftLogBase.checkLogState(RaftLogBase.java:113)
	at org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.getLastEntryTermIndex(SegmentedRaftLog.java:356)
	at org.apache.ratis.server.impl.ServerState.getLastEntry(ServerState.java:316)
	at org.apache.ratis.server.impl.RaftServerImpl.requestVote(RaftServerImpl.java:1466)
	at org.apache.ratis.server.impl.RaftServerImpl.requestVote(RaftServerImpl.java:1422)
	at org.apache.ratis.server.impl.RaftServerProxy.requestVote(RaftServerProxy.java:642)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$1.handleRequest(SimulatedServerRpc.java:165)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$1.handleRequest(SimulatedServerRpc.java:153)
	at org.apache.ratis.server.simulation.RequestHandler.handleRequest(RequestHandler.java:91)
	at org.apache.ratis.server.simulation.RequestHandler$HandlerDaemon.run(RequestHandler.java:125)
Caused by: org.apache.ratis.util.OpenCloseState$CloseTrace: Close s0@group-C0E65F787AE8-SegmentedRaftLog
	at org.apache.ratis.util.OpenCloseState.lambda$close$1(OpenCloseState.java:109)
	at java.util.concurrent.atomic.AtomicReference.getAndUpdate(AtomicReference.java:160)
	at org.apache.ratis.util.OpenCloseState.close(OpenCloseState.java:109)
	at org.apache.ratis.server.raftlog.RaftLogBase.close(RaftLogBase.java:394)
	at org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.close(SegmentedRaftLog.java:528)
	at org.apache.ratis.server.impl.ServerState.close(ServerState.java:440)
	at org.apache.ratis.server.impl.RaftServerImpl.lambda$close$1(RaftServerImpl.java:550)
	at org.apache.ratis.util.LifeCycle.lambda$checkStateAndClose$7(LifeCycle.java:309)
	at org.apache.ratis.util.LifeCycle.checkStateAndClose(LifeCycle.java:329)
	at org.apache.ratis.util.LifeCycle.checkStateAndClose(LifeCycle.java:307)
	at org.apache.ratis.server.impl.RaftServerImpl.close(RaftServerImpl.java:527)
	at org.apache.ratis.server.impl.RaftServerImpl.groupRemove(RaftServerImpl.java:485)
	at org.apache.ratis.server.impl.RaftServerProxy.lambda$groupRemoveAsync$15(RaftServerProxy.java:554)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
	at java.util.concurrent.CompletableFuture.uniApplyStage(CompletableFuture.java:628)
	at java.util.concurrent.CompletableFuture.thenApply(CompletableFuture.java:1996)
	at org.apache.ratis.server.impl.RaftServerProxy.groupRemoveAsync(RaftServerProxy.java:553)
	at org.apache.ratis.server.impl.RaftServerProxy.groupManagementAsync(RaftServerProxy.java:502)
	at org.apache.ratis.server.impl.RaftServerProxy.groupManagement(RaftServerProxy.java:482)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$2.handleRequest(SimulatedServerRpc.java:189)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$2.handleRequest(SimulatedServerRpc.java:177)
	... 2 more

org.apache.ratis.server.simulation.TestGroupManagementWithSimulatedRpc.testGroupWithPriority -- Time elapsed: 0.003 s <<< FAILURE!
java.lang.AssertionError: Unexpected exit.
	at org.apache.ratis.util.ExitUtils.assertNotTerminated(ExitUtils.java:109)
	at org.apache.ratis.BaseTest.assertNoFailures(BaseTest.java:99)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	Suppressed: org.opentest4j.TestAbortedException: Assumption failed: Already exited with org.apache.ratis.util.ExitUtils$ExitException: s0.serverHandler2 is terminating.
		at org.apache.ratis.BaseTest.checkAssumptions(BaseTest.java:89)
		at org.apache.ratis.BaseTest.setup(BaseTest.java:76)
		... 3 more
Caused by: org.apache.ratis.util.ExitUtils$ExitException: s0.serverHandler2 is terminating.
	at org.apache.ratis.util.ExitUtils.terminate(ExitUtils.java:141)
	at org.apache.ratis.util.ExitUtils.terminate(ExitUtils.java:151)
	at org.apache.ratis.server.simulation.RequestHandler$HandlerDaemon.run(RequestHandler.java:138)
Caused by: java.lang.IllegalStateException: s0@group-C0E65F787AE8-SegmentedRaftLog is expected to be opened but it is CLOSED
	at org.apache.ratis.util.OpenCloseState.assertOpen(OpenCloseState.java:63)
	at org.apache.ratis.server.raftlog.RaftLogBase.checkLogState(RaftLogBase.java:113)
	at org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.getLastEntryTermIndex(SegmentedRaftLog.java:356)
	at org.apache.ratis.server.impl.ServerState.getLastEntry(ServerState.java:316)
	at org.apache.ratis.server.impl.RaftServerImpl.requestVote(RaftServerImpl.java:1466)
	at org.apache.ratis.server.impl.RaftServerImpl.requestVote(RaftServerImpl.java:1422)
	at org.apache.ratis.server.impl.RaftServerProxy.requestVote(RaftServerProxy.java:642)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$1.handleRequest(SimulatedServerRpc.java:165)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$1.handleRequest(SimulatedServerRpc.java:153)
	at org.apache.ratis.server.simulation.RequestHandler.handleRequest(RequestHandler.java:91)
	at org.apache.ratis.server.simulation.RequestHandler$HandlerDaemon.run(RequestHandler.java:125)
Caused by: org.apache.ratis.util.OpenCloseState$CloseTrace: Close s0@group-C0E65F787AE8-SegmentedRaftLog
	at org.apache.ratis.util.OpenCloseState.lambda$close$1(OpenCloseState.java:109)
	at java.util.concurrent.atomic.AtomicReference.getAndUpdate(AtomicReference.java:160)
	at org.apache.ratis.util.OpenCloseState.close(OpenCloseState.java:109)
	at org.apache.ratis.server.raftlog.RaftLogBase.close(RaftLogBase.java:394)
	at org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.close(SegmentedRaftLog.java:528)
	at org.apache.ratis.server.impl.ServerState.close(ServerState.java:440)
	at org.apache.ratis.server.impl.RaftServerImpl.lambda$close$1(RaftServerImpl.java:550)
	at org.apache.ratis.util.LifeCycle.lambda$checkStateAndClose$7(LifeCycle.java:309)
	at org.apache.ratis.util.LifeCycle.checkStateAndClose(LifeCycle.java:329)
	at org.apache.ratis.util.LifeCycle.checkStateAndClose(LifeCycle.java:307)
	at org.apache.ratis.server.impl.RaftServerImpl.close(RaftServerImpl.java:527)
	at org.apache.ratis.server.impl.RaftServerImpl.groupRemove(RaftServerImpl.java:485)
	at org.apache.ratis.server.impl.RaftServerProxy.lambda$groupRemoveAsync$15(RaftServerProxy.java:554)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
	at java.util.concurrent.CompletableFuture.uniApplyStage(CompletableFuture.java:628)
	at java.util.concurrent.CompletableFuture.thenApply(CompletableFuture.java:1996)
	at org.apache.ratis.server.impl.RaftServerProxy.groupRemoveAsync(RaftServerProxy.java:553)
	at org.apache.ratis.server.impl.RaftServerProxy.groupManagementAsync(RaftServerProxy.java:502)
	at org.apache.ratis.server.impl.RaftServerProxy.groupManagement(RaftServerProxy.java:482)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$2.handleRequest(SimulatedServerRpc.java:189)
	at org.apache.ratis.server.simulation.SimulatedServerRpc$2.handleRequest(SimulatedServerRpc.java:177)
	... 2 more

