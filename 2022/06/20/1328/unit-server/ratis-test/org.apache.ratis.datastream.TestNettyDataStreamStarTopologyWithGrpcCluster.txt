-------------------------------------------------------------------------------
Test set: org.apache.ratis.datastream.TestNettyDataStreamStarTopologyWithGrpcCluster
-------------------------------------------------------------------------------
Tests run: 4, Failures: 0, Errors: 4, Skipped: 0, Time elapsed: 24.743 s <<< FAILURE! - in org.apache.ratis.datastream.TestNettyDataStreamStarTopologyWithGrpcCluster
testMultipleStreamsSingleServer(org.apache.ratis.datastream.TestNettyDataStreamStarTopologyWithGrpcCluster)  Time elapsed: 2.859 s  <<< ERROR!
java.util.concurrent.CompletionException: java.lang.AssertionError: expected same:<DataStreamReplyByteBuffer:clientId=client-C66B6F682357,type=STREAM_DATA,id=5,offset=7679031,length=0,SUCCESS,bytesWritten=0> was not:<DataStreamReplyByteBuffer:clientId=client-C66B6F682357,type=STREAM_DATA,id=5,offset=7679031,length=152,SUCCESS,bytesWritten=0>
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
	at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:975)
	at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:940)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)
	at org.apache.ratis.client.impl.OrderedStreamAsync$DataStreamWindowRequest.setReply(OrderedStreamAsync.java:82)
	at org.apache.ratis.client.impl.OrderedStreamAsync$DataStreamWindowRequest.setReply(OrderedStreamAsync.java:48)
	at org.apache.ratis.util.SlidingWindow$RequestMap.setReply(SlidingWindow.java:144)
	at org.apache.ratis.util.SlidingWindow$Client.receiveReply(SlidingWindow.java:316)
	at org.apache.ratis.client.impl.OrderedStreamAsync.lambda$sendRequestToNetwork$4(OrderedStreamAsync.java:155)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)
	at org.apache.ratis.netty.client.NettyClientStreamRpc$1.channelRead(NettyClientStreamRpc.java:268)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	at org.apache.ratis.thirdparty.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:327)
	at org.apache.ratis.thirdparty.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:299)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	at org.apache.ratis.thirdparty.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:722)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:658)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:584)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:496)
	at org.apache.ratis.thirdparty.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at org.apache.ratis.thirdparty.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.AssertionError: expected same:<DataStreamReplyByteBuffer:clientId=client-C66B6F682357,type=STREAM_DATA,id=5,offset=7679031,length=0,SUCCESS,bytesWritten=0> was not:<DataStreamReplyByteBuffer:clientId=client-C66B6F682357,type=STREAM_DATA,id=5,offset=7679031,length=152,SUCCESS,bytesWritten=0>
	at org.junit.Assert.fail(Assert.java:89)
	at org.junit.Assert.failNotSame(Assert.java:829)
	at org.junit.Assert.assertSame(Assert.java:772)
	at org.junit.Assert.assertSame(Assert.java:783)
	at org.apache.ratis.datastream.DataStreamTestUtils.assertCloseReply(DataStreamTestUtils.java:347)
	at org.apache.ratis.datastream.DataStreamTestUtils.lambda$writeAndCloseAndAssertReplies$0(DataStreamTestUtils.java:323)
	at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:966)
	... 33 more

testMultipleStreamsMultipleServers(org.apache.ratis.datastream.TestNettyDataStreamStarTopologyWithGrpcCluster)  Time elapsed: 8.21 s  <<< ERROR!
java.util.concurrent.CompletionException: java.lang.AssertionError: expected same:<DataStreamReplyByteBuffer:clientId=client-B57CB4386EAD,type=STREAM_DATA,id=100,offset=6712614,length=0,SUCCESS,bytesWritten=0> was not:<DataStreamReplyByteBuffer:clientId=client-B57CB4386EAD,type=STREAM_DATA,id=100,offset=6712614,length=305,SUCCESS,bytesWritten=0>
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
	at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:975)
	at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:940)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)
	at org.apache.ratis.client.impl.OrderedStreamAsync$DataStreamWindowRequest.setReply(OrderedStreamAsync.java:82)
	at org.apache.ratis.client.impl.OrderedStreamAsync$DataStreamWindowRequest.setReply(OrderedStreamAsync.java:48)
	at org.apache.ratis.util.SlidingWindow$RequestMap.setReply(SlidingWindow.java:144)
	at org.apache.ratis.util.SlidingWindow$Client.receiveReply(SlidingWindow.java:316)
	at org.apache.ratis.client.impl.OrderedStreamAsync.lambda$sendRequestToNetwork$4(OrderedStreamAsync.java:155)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)
	at org.apache.ratis.netty.client.NettyClientStreamRpc$1.channelRead(NettyClientStreamRpc.java:268)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	at org.apache.ratis.thirdparty.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:327)
	at org.apache.ratis.thirdparty.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:299)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	at org.apache.ratis.thirdparty.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:722)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:658)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:584)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:496)
	at org.apache.ratis.thirdparty.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at org.apache.ratis.thirdparty.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.AssertionError: expected same:<DataStreamReplyByteBuffer:clientId=client-B57CB4386EAD,type=STREAM_DATA,id=100,offset=6712614,length=0,SUCCESS,bytesWritten=0> was not:<DataStreamReplyByteBuffer:clientId=client-B57CB4386EAD,type=STREAM_DATA,id=100,offset=6712614,length=305,SUCCESS,bytesWritten=0>
	at org.junit.Assert.fail(Assert.java:89)
	at org.junit.Assert.failNotSame(Assert.java:829)
	at org.junit.Assert.assertSame(Assert.java:772)
	at org.junit.Assert.assertSame(Assert.java:783)
	at org.apache.ratis.datastream.DataStreamTestUtils.assertCloseReply(DataStreamTestUtils.java:347)
	at org.apache.ratis.datastream.DataStreamTestUtils.lambda$writeAndCloseAndAssertReplies$0(DataStreamTestUtils.java:323)
	at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:966)
	... 33 more

testMultipleStreamsMultipleServersStepDownLeader(org.apache.ratis.datastream.TestNettyDataStreamStarTopologyWithGrpcCluster)  Time elapsed: 8.251 s  <<< ERROR!
java.util.concurrent.CompletionException: java.lang.AssertionError: expected same:<DataStreamReplyByteBuffer:clientId=client-C5B54C3C1F27,type=STREAM_DATA,id=200,offset=7974866,length=0,SUCCESS,bytesWritten=0> was not:<DataStreamReplyByteBuffer:clientId=client-C5B54C3C1F27,type=STREAM_DATA,id=200,offset=7974866,length=309,SUCCESS,bytesWritten=0>
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
	at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1005)
	at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2137)
	at org.apache.ratis.datastream.DataStreamTestUtils.writeAndCloseAndAssertReplies(DataStreamTestUtils.java:322)
	at org.apache.ratis.datastream.DataStreamAsyncClusterTests.lambda$runTestDataStream$5(DataStreamAsyncClusterTests.java:156)
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.AssertionError: expected same:<DataStreamReplyByteBuffer:clientId=client-C5B54C3C1F27,type=STREAM_DATA,id=200,offset=7974866,length=0,SUCCESS,bytesWritten=0> was not:<DataStreamReplyByteBuffer:clientId=client-C5B54C3C1F27,type=STREAM_DATA,id=200,offset=7974866,length=309,SUCCESS,bytesWritten=0>
	at org.junit.Assert.fail(Assert.java:89)
	at org.junit.Assert.failNotSame(Assert.java:829)
	at org.junit.Assert.assertSame(Assert.java:772)
	at org.junit.Assert.assertSame(Assert.java:783)
	at org.apache.ratis.datastream.DataStreamTestUtils.assertCloseReply(DataStreamTestUtils.java:347)
	at org.apache.ratis.datastream.DataStreamTestUtils.lambda$writeAndCloseAndAssertReplies$0(DataStreamTestUtils.java:323)
	at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:995)
	... 7 more

testStreamWrites(org.apache.ratis.datastream.TestNettyDataStreamStarTopologyWithGrpcCluster)  Time elapsed: 5.365 s  <<< ERROR!
java.util.concurrent.CompletionException: java.lang.IllegalStateException: id is empty.
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:618)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)
	at org.apache.ratis.client.impl.OrderedStreamAsync$DataStreamWindowRequest.setReply(OrderedStreamAsync.java:82)
	at org.apache.ratis.client.impl.OrderedStreamAsync$DataStreamWindowRequest.setReply(OrderedStreamAsync.java:48)
	at org.apache.ratis.util.SlidingWindow$RequestMap.setReply(SlidingWindow.java:144)
	at org.apache.ratis.util.SlidingWindow$Client.receiveReply(SlidingWindow.java:316)
	at org.apache.ratis.client.impl.OrderedStreamAsync.lambda$sendRequestToNetwork$4(OrderedStreamAsync.java:155)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)
	at org.apache.ratis.netty.client.NettyClientStreamRpc$1.channelRead(NettyClientStreamRpc.java:268)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	at org.apache.ratis.thirdparty.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:327)
	at org.apache.ratis.thirdparty.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:299)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	at org.apache.ratis.thirdparty.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	at org.apache.ratis.thirdparty.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	at org.apache.ratis.thirdparty.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:722)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:658)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:584)
	at org.apache.ratis.thirdparty.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:496)
	at org.apache.ratis.thirdparty.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at org.apache.ratis.thirdparty.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.IllegalStateException: id is empty.
	at org.apache.ratis.util.Preconditions.assertTrue(Preconditions.java:45)
	at org.apache.ratis.protocol.RaftPeerId.<init>(RaftPeerId.java:67)
	at java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1688)
	at org.apache.ratis.protocol.RaftPeerId.valueOf(RaftPeerId.java:41)
	at org.apache.ratis.util.ProtoUtils.toRaftGroupMemberId(ProtoUtils.java:202)
	at org.apache.ratis.client.impl.ClientProtoUtils.toRaftClientReply(ClientProtoUtils.java:370)
	at org.apache.ratis.client.impl.ClientProtoUtils.toRaftClientReply(ClientProtoUtils.java:365)
	at org.apache.ratis.client.impl.ClientProtoUtils.getRaftClientReply(ClientProtoUtils.java:358)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
	... 33 more

